

<html>
  <head>
    <title>Home</title>
    <!--<script type="text/javascript">
      window.location.replace("comingsoon.html");
    </script>-->
    <script src="https://cdn.jsdelivr.net/npm/p5@0.10.2/lib/p5.js"></script>
    <link rel="stylesheet" href="style.css" />
    <script src="https://code.jquery.com/jquery-3.4.1.js"></script>
    <!-- <script src="./node_modules/axios/dist/axios.min.js"></script> -->

    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@300;400;500;600&display=swap"
      rel="stylesheet"
    />
  </head>

  <!-- API key for donorbox: ijBKAnIcBzXWv597Ff5D4KIaBFVIDbMfnWXi4AFxu1uij73Jil3JOQ -->

  <body>
    <a href="donate.html">
      <button class="donate">
        Donate Now
      </button>
    </a>

    <div class="header">
      <div class="left"><a href="index.html">Piedmont</a></div>
      <div class="right">
        <div class="nav"><a href="move.html">The Movement</a></div>
        <div class="nav">
          <a href="calculate.html">Contribution Calculator</a>
        </div>
        <div class="nav"><a href="about.html">About Us</a></div>
      </div>
    </div>
    <div class="spacer"></div>
    <div class="textcontain">
        <div class="maintext">
        Piedmont has raised <span id="bigmoney">$2,035,125</span> for BLM. Care to add on?
      </div>
    </div>

      <div class="topochico">

        <div class="totheleft">
          <button class="most" id="most-recent-btn">Most recent</button>
          <button class="highest" id="highest-donation-btn">Highest Donations</button>
        </div>

        <div class="totheright">

              <input class="search" placeholder="Search" type="text" id="fname" name="fname"><br>
              <button class="seek"><img class="magnify" src="seeker.png"></img></button>

        </div>
      </div>

      <div class="leader" id="leader-list" style="flex-direction: column">
          <!-- <button id="authorize_button" style="display: none;">Authorize</button>
          <button id="signout_button" style="display: none;">Sign Out</button> -->
        <!-- <div class="rightright" style="flex-direction:column;" id="leader-list">

        </div>
        <div class="wrongwrong" id="times-list" style="flex-direction:column;">

        </div> -->
        <!-- <pre id="content" style="white-space: pre-wrap;"></pre> -->
      </div>

      <!-- <script src="index.js" ></script> -->

      <script type="text/javascript">

        //API key: AIzaSyD8JIqf1qEaiwTFKKuFYpTRsE2ek8S4oyE
        // Client ID and API key from the Developer Console
        var CLIENT_ID = '239112592362-oogbtgit5om42erh2676hq820v6vvvue.apps.googleusercontent.com';
        var API_KEY = 'AIzaSyD8JIqf1qEaiwTFKKuFYpTRsE2ek8S4oyE'

        // // Array of API discovery doc URLs for APIs used by the quickstart
        var DISCOVERY_DOCS = ["https://sheets.googleapis.com/$discovery/rest?version=v4"];

        // // Authorization scopes required by the API; multiple scopes can be
        // // included, separated by spaces.
        var SCOPES = "https://www.googleapis.com/auth/spreadsheets.readonly";

        // var authorizeButton = document.getElementById('authorize_button');
        // var signoutButton = document.getElementById('signout_button');

        // /**
        //  *  On load, called to load the auth2 library and API client library.
        //  */
        function handleClientLoad() {
          gapi.load('client:auth2', initClient);
        }

        // /**
        //  *  Initializes the API client library and sets up sign-in state
        //  *  listeners.
        //  */
        function initClient() {
          gapi.client.init({
            apiKey: API_KEY,
            clientId: CLIENT_ID,
            discoveryDocs: DISCOVERY_DOCS,
            scope: SCOPES
          }).then(function () {
          }, function(error) {
            console.log(error)
          });
        }

        const base = 'https://sheets.googleapis.com/v4/spreadsheets/11QHV5h0HGR1zfSQ3QpzztlTQkWm-GyK8H-IqT_zuvew/values/';

        // ["6911336", "Kaili", "Wang", "$6.00", "2020-06-11 2:00:00", "FALSE"]
        //define the index constants
        const FIRST_NAME = 1;
        const LAST_NAME = 2;
        const AMOUNT = 3;
        const DATE = 4;
        const ANONYMOUS = 5;

        //for leaderboard
        const donationsRange = 'Donors!B2:G?key=';
        axios.get(base + donationsRange + API_KEY).then(res => {
          let rows = res.data.values;
          //example of a row:
          // ["6911336", "Kaili", "Wang", "$6.00", "2020-06-11 2:00:00", "FALSE"]
          console.log(rows);

          rows = rows.map(row => {
            let day = new Date(row[DATE]);
            let anon = row[ANONYMOUS] === "TRUE" ? true : false;
            let newRow = row;
            newRow[AMOUNT] = Number(row[AMOUNT].substring(1));
            newRow[DATE] = day;
            newRow[ANONYMOUS] = anon;
            return newRow;
          });

          //now, rows would be like ["6911336", "Kaili", "Wang", 6.00, Date object, false]

          // const leaders = document.getElementById("leader-list");
          const leaders = $('#leader-list');
          // let dateList = document.getElementById("times-list");

          const mostRecentButton = $("#most-recent-btn");
          const highestDonationsButton = $("#highest-donation-btn");

          // console.log(leaders);

          const displayLeaders = (arr) => {
            arr.map(function (row, i) {
              // let leader = document.createElement("div");
              // let donation = document.createElement("div");
              const name = row[ANONYMOUS]  ? "Anonymous" : `${row[FIRST_NAME]} ${row[LAST_NAME]}`;
              let donation = `<div><span id="amount">$${row[3]} </span> by <span id="richfuck"> ${name}</span></div>`;
              // leader.append(donation);

              // let date = document.createElement("div");



              //Jono:
              // you can do date.style._styleprop_ = 'propertyvalue'; like i did below with leader

              let day = row[DATE];
              // console.log(day);
              let date = `<div><span id="date">${day.getMonth()}/${day.getDate()}/${day.getFullYear()}</span></div>`;
              let leader = `<div class="leader-elem">${donation}${date}</div>`;
              

              // leader.style.display = 'flex';
              // leader.style.flexDirection = 'row';
              // leader.style.width = '100%';
              // leader.style.paddingTop = '20px';
              // leader.style.paddingBottom = '20px';
              // leader.style.borderBottomStyle = 'solid';
              // leader.style.borderWidth = '1px';
              // leader.style.justifyContent = 'space-between'
              // leader.style.fontSize = '0.3em';



              /*
              leader div
              ----------------------------------------------------
              | donation div                             date div |
              | |^^^^^^^^^^^^|                           |^^^^^^^||
              |  ^^^^^^^^^^^^                             ^^^^^^^ |
              ----------------------------------------------------
              */

              // leader.appendChild(date);
              leaders.append(leader);
            });
          }

          mostRecentButton.on('click',  () => {
            highestDonationsButton.removeClass('active-filter');
            mostRecentButton.addClass('active-filter');
            // leaders.innerHTML = ""; //clears table
            leaders.html("");
            let newRows = rows.sort((a, b) => {
              return b[DATE] - a[DATE];
              //  if (a[DATE] > b[DATE]) return -1;
              //  if (a[DATE] == b[DATE]) return 0;
            });
            console.log(newRows);
            displayLeaders(rows.slice(0, 30));
          });

          const displayHighest = () => {
            highestDonationsButton.addClass('active-filter');
            mostRecentButton.removeClass('active-filter');
            // leaders.innerHTML = "";
            leaders.html("");
            let newRows = rows.sort((a, b) => b[AMOUNT] - a[AMOUNT]);
            console.log(newRows);
            displayLeaders(rows.slice(0, 30));
          }

          // highestDonationsButton.onclick = displayHighest;
          highestDonationsButton.on('click', displayHighest);
          //default
          // displayHighest();
          highestDonationsButton.click();


        })
        .catch(e => {
          console.log(e);
        })

        //updating the total amount
        const totalRange = 'Main!A2?key=';
        axios.get(base + totalRange + API_KEY).then(res => {
          const total = res.data.values[0];
          console.log(res.data.values[0]);
          document.getElementById("bigmoney").innerHTML = total;
        })
        .catch(e => {
          console.log(e);
        });

      </script>

      <script async defer src="https://apis.google.com/js/api.js"
        onload="this.onload=function(){};handleClientLoad()"
        onreadystatechange="if (this.readyState === 'complete') this.onload()">
      </script>
    </div>
  </body>
</html>
